# 大型网站技术架构：概述

<!-- toc -->

## 大型网站软件系统的特点：

1. 高并发，大流量
2. 高可用（7X24 小时不间断服务）
3. 海量数据
4. 用户分布广泛，网络情况复杂
5. 安全环境恶劣
6. 需求快速变更，发布频繁
7. 渐进式发展

## 大型网站架构演化发展历程：

1. 初始阶段：应用程序、数据库、文件等所有资源都在一台服务器上（LAMP, Linux + Apach + MySQL + PHP）
2. 应用服务和数据服务分离：此时使用三台服务器

  - 应用服务器：处理大量的业务逻辑，需要更快的CPU
  - 文件服务器：存储大量用户上传的文件，需要更大的硬盘
  - 数据库服务器：快速磁盘检索和数据缓存，需要更快的硬盘和更大的内存
  - 痛点：用户增多会导致数据库访问压力增大从而发生访问延迟

3. 使用缓存改善网站性能

  - 基于思想：80% 的业务访问集中在 20% 的数据上
  - 因此可以将这小部分数据缓存在内存中以减少数据库服务器的访问压力
  - 网站使用的缓存分为两种：

    - 本地缓存：缓存在应用服务器上，速度快，但是缓存数据有限
    - 远程缓存：缓存在专门的分布式缓存服务器上，可以使用**集群**方式

  - 痛点：单一应用服务器能够处理的请求连接数有限，在网站访问的高峰期，应用服务器成为整个网站的瓶颈

4. 使用应用服务器集群改善网站的并发处理能力

  - 集群是网站解决高并发、海量数据问题的常用手段
  - 增加一个负载均衡调度服务器，可将来自用户浏览器的访问请求分发到应用服务器集群中的任一服务器上

5. 数据库读写分离

  - 痛点：即使应用服务器使用了缓存后，仍有一部分读操作（访问未命中，缓存过期）和全部的写操作需要访问数据库，当达到一定规模后会成为瓶颈
  - 配置两台数据库的主从关系，可以将一台数据库服务器上的数据同步到另一台服务器上，实现读写分离
  - 应用服务器写数据的时候访问主服务器，读数据的时候访问从服务器

6. 使用反向代理和 CDN 加速网站响应

  - 反向代理和 CDN 的基本原理都是**缓存**

7. 使用分布式文件系统和分布式数据库系统

  - 分布式数据库是网站数据拆分的最后手段，更常用的手段是业务分库，将不同业务的数据库部署在不同的物理服务器上

8. 使用 NoSQL 和搜索引擎

9. 业务拆分

10. 分布式服务

## 网站架构设计误区：

- 一味追随大公司的解决方案
- 为了技术而技术
- 企图用技术解决所有问题

> 是业务成就了技术，是事业成就了人，而不是相反。

## 网站架构模式

1. 分层（软件横向切分）
2. 分割（软件纵向切分）
3. 分布式

  - 分布式应用和服务
  - 分布式静态资源
  - 分布式数据和存储
  - 分布式计算

4. 集群

  - 多台服务器部署一个应用构成一个集群，通过负载均衡设备共同对外提供服务

5. 缓存

  - CDN/反向代理/本地缓存/分布式缓存
  - 使用缓存的两个前提：

    1. 数据访问热点不均衡，某些数据会被更多地访问
    2. 数据在某个时间段内有效，不会很快就过期

6. 异步（降低耦合）

7. 冗余
8. 自动化
9. 安全

## 网站核心架构要素

1. 性能
2. 可用性
3. 伸缩性
4. 扩展性
5. 安全性
